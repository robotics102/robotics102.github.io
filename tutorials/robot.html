---
layout: default
tutorial: true
---

<section>
    <header class="main project">
      <strong>Tutorial:</strong> Using the MBot-Omni Robot Platform
    </header>

    <p><span class="image right"><img src="/assets/images/MBot_spotlight_square.jpg" alt="" /></span>
      The <strong>MBot-Omni</strong> is an omnidrive robot platform which we will be programming in ROB 102. This
      tutorial contains instructions on how to use it and program it.</p>

    <p>This page has the following parts:</p>
    <ul>
      <li><a href="#quickstart">MBot Quick Start</a></li>
      <li><a href="#sec_robot_care">Robot Usage &amp; Care</a></li>
      <li><a href="#sec_robot_prog">Programming the Robot</a>
        <ul>
          <li><a href="#sec_conn_robot">Connecting to the robot</a></li>
          <li><a href="#conn_video">Video tutorial</a></li>
        </ul>
      </li>
      <li><a href="#localization">Mapping &amp; Localization</a></li>
    </ul>
</section>

<section id="quickstart">
  <header class="major">
    <h2><a href="#quickstart">MBot Quick Start</a></h2>
  </header>
  <!-- <div class="content"> -->
    <p>A fully setup robot should be drivable through the MBot Web App. This guide will show you how to drive around your MBot!</p>

    <ul>
      <li>
        <strong>Turn the robot on.</strong>
        For instructions, check <a href="#sec_robot_on">here</a>.
      </li>
      <li id="get-robot-ip">
        <strong>Get your robot's IP.</strong>
        The robot should publish its IP to an IP registry when it starts up. The default IP registry is <a href="https://github.com/MBot-Project-Development/mbot_ip_registry" target="_blank">this GitHub repository</a>.
        <i>Note: Double check the registry with your course staff if you aren't sure.</i>
        <br/>
        The robot pushes its IP to a file called <code>data/mbot[-GROUP]-XXX.json</code> corresponding to the robot's name and ID. The name should match the label on the robot. Get the robot's IP from the data folder:
        <span class="image centered"><img src="/assets/images/tutorials/robot/get_ip.png" alt=""
          style="max-width:800px;" /></span>
      </li>
      <li>
        <strong>Connect to the MBot Web App.</strong>
        Each MBot is hosting its own web app. You can access it by typing the IP from the previous step into your browser.
      </li>
      <li>
        <strong>Drive the robot!</strong>
        Toggle &quot;Drive Mode&quot; on the web app side panel to activate it. Use your keyboard keys AWSDQE to drive the robot. W and S will move backwards and forwards, A and D will move left and right (on omnidrive robots only), and Q and E will rotate the robot.
      </li>
    </ul>

    <ul class="hint">
      <li class="icon solid fa-cogs"><strong>Debugging Tip:</strong> Make sure that the file in the IP registry is recent by checking the time that it was updated. The IP can change when rebooted. It can take a few minutes for the robot to boot up and connect, so be patient! If the IP is not updated after a few minutes, try restarting the robot.</li>
    </ul>

  <!-- </div> -->
</section>

<!-- ROBOT CARE -->
<section id="sec_robot_care">
  <header class="major">
    <h2><a href="#sec_robot_care">Robot Usage &amp; Care</a></h2>
  </header>
  <div class="content">
    <h3 id="sec_robot_on">Turning the robot on</h3>

    <p>To turn the robot on, flick the switch on the power bank to ON. The red light on the Raspberry Pi should turn on.</p>

    <h3 id="sec_robot_off">Turning the robot off</h3>

    <p>To turn the robot off, first type <code>sudo shutdown now</code> in the terminal of the robot. This will shut down the Raspberry Pi.
      One the lidar stops spinning, flick the switch on the power bank to OFF.</p>
    <h3 id="sec_robot_net">Robot network</h3>

    <p>
      Each robot should be marked with a unique, three digit ID, plus a prefix (001, 002, etc.). When turned on, the robot will connect to the MWireless WiFi network. This will only work on campus.
    </p>

    <h3 id="sec_robot_batt">Robot battery care</h3>

    <ul>
      <li><strong>Charging the batteries:</strong> Plug the battery into the power supply. Switch the battery to ON to
        charge it. The power adapter will have a red light while it's charging, and it will turn green when done. Switch
        the battery to OFF to store.</li>
      <li>Batteries are shared across all robots. There are bins labelled &quot;CHARGED BATTERIES&quot; and
        &quot;UNCHARGED BATTERIES.&quot; Batteries should be placed in the appropriate bin.</li>
      <li>Always plug in uncharged batteries right away. They take a long time to charge.</li>
      <li>When a battery has three of five green lights on, it should be replaced.</li>
      <li><em>Tip:</em> When you aren't using the Lidar, unplug the Micro USB cord from its board to disconnect it from
        the Raspberry Pi. When it spins, it draws a lot of power and drains the battery quickly.</li>
    </ul>
  </div>
</section>

<!-- PROGRAMMING ROBOT -->
<section id="sec_robot_prog">
  <header class="major">
    <h2><a href="#sec_robot_prog">Programming the Robot</a></h2>
  </header>
  <div class="content">
    <p>We will program the robot using VSCode's Remote Development extension. The extension allows us to connect to a
      remote host in a VSCode window and write code on its filesystem.</p>

    <h3>Prerequisites</h3>

    <p>This tutorial assumes you have followed the instructions for installing <a href="setup.html#install_vscode">VSCode</a>. You will need a laptop connected to the same WiFi as the robot (this is MWireless on the UM campus).</p>

    <p>You will also need to <a href="#sec_robot_on">turn the robot on</a> and <a href="#get-robot-ip">get its IP address</a>.</p>

    <h2 id="sec_conn_robot">Connecting to the robot</h2>

    <h3>1. Add the Remote Development extension</h3>

    <p>First, we need the VSCode Remote Development extension, which will allow us to connect VSCode to the robot's
      environment. Open VSCode and click on the &quot;Extensions&quot; icon <span><img
          src="https://raw.githubusercontent.com/microsoft/vscode-icons/master/icons/light/extensions.svg?sanitize=true"></span>
      in the toolbar on the left. Search for &quot;Remote Development&quot; and select the extension called &quot;Remote
      Development.&quot; Click &quot;Install&quot; to install it.</p>

    <span class="image main"><img src="/assets/images/tutorials/robot/install-remote-ext.jpg" alt=""
        style="max-width:800px;" /></span>

    <!-- <h3>2. Get the robot's IP address</h3> -->

    <!-- <p>
      Since the robot connects to MWireless, any device connected the same WiFi network can communicate with the robot. To connect, we need a unique identifier that tells us where to find the robot on the network, called an <i>IP address</i>.
      When it connects, the robot will put its IP address <a href="https://github.com/MBot-Project-Development/mbot_ip_registry">in an MBot IP registry GitHub repo</a>.
      Look in the <strong>data</strong> folder for a file called <strong>mbot-omni-XXX.json</strong> (replace <strong>XXX</strong> with the ID of the robot).
      The ID should be written on a label on the robot.
      When you open this file, you will find the IP of the robot, as shown below. Copy it for the next step.
    </p> -->

    <!-- <span class="image main"><img src="/assets/images/tutorials/robot/get_ip.png" alt=""
        style="max-width:800px;" /></span> -->

    <!-- <p>If the robot is connected and working properly, you should be able to see the web app by going to <strong>http://&lt;ROBOT-IP&gt;:8000</strong> (replace all of <strong>&lt;ROBOT-IP&gt;</strong> with your robot's IP address). You should be able to drive it around when you enable Drive Mode.</p> -->

    <!-- <ul class="hint">
      <li class="icon solid fa-cogs"><strong>Debugging Tip:</strong> Make sure that the file on GitHub is recent by checking the time that it was updated. The IP can change when rebooted. It can take a few minutes for the robot to boot up and connect, so be patient! If the IP is not updated after a few minutes, try restarting the robot.</li>
    </ul> -->

    <h3>2. Add the Raspberry Pi as a remote host</h3>

    <p>
      Now we will tell VSCode how to connect to the Raspberry Pi board on the robot.
      To add the Raspberry Pi as a remote host in VSCode, click on the &quot;Remote Explorer&quot; in the toolbar on
      the left. Then, select the + to add a new host:
    </p>

    <span class="image main"><img src="/assets/images/tutorials/robot/remote-add-target.png" alt=""
        style="max-width:400px;" /></span>

    <p>In the box that appears, type in the following command:</p>
    <pre><code class="language-bash">ssh &lt;ROBOT-USER&gt;@&lt;ROBOT-IP&gt;</code></pre>
    <p>Replace all of <code>&lt;ROBOT-IP&gt;</code> with the IP address of your robot, and all of <code>&lt;ROBOT-USER&gt;</code> with the robot's username. The username is <code>mbot</code> by default. Check with course staff if you aren't sure.
    </p>

    <span class="image main"><img src="/assets/images/tutorials/robot/remote-ssh-command.png" alt=""
        style="max-width:600px;" /></span>

    <p>Press Enter, then select the default configuration file when the option appears:</p>

    <span class="image main"><img src="/assets/images/tutorials/robot/remote-ssh-config.png" alt=""
        style="max-width:600px;" /></span>

    <h3>3. Connect to the Raspberry Pi</h3>

    <p>To connect to the Raspberry Pi, open the &quot;Remote Explorer&quot; tab again, and select the new remote host
      you just added. If it doesn't appear, press the refresh button. Click on the icon to the right of the address to connect to the host in a new window.</p>

    <span class="image main"><img src="/assets/images/tutorials/robot/remote-connect-host.png" alt=""
        style="max-width:400px;" /></span>

    <p>If you are already in a new VSCode window with no other files open, you can also right-click on the host address
      to connect in the current window. You will be asked to select a platform. Select &quot;Linux&quot;.</p>

    <span class="image main"><img src="/assets/images/tutorials/robot/remote-platform-linux.png" alt=""
        style="max-width:600px;" /></span>

    <p>You will be asked for the password to the Raspberry Pi. The default password is <b>i&lt;3robots!</b>.
      The first time you connect, it will take a few minutes for VSCode to do some setup
      on the Raspberry Pi. You should see the address of the Raspberry Pi on the bottom left of the VSCode window.</p>

    <span class="image main"><img src="/assets/images/tutorials/robot/remote-connected.png" alt=""
        style="max-width:300px;" /></span>

    <h3>4. Opening a terminal</h3>

    <p>In the VSCode window which is connected to the robot, open a terminal by clicking on &quot;Terminal&quot; &gt;
      &quot;New Terminal.&quot; A terminal will open on the Raspberry Pi. You can type command line commands in this
      terminal.</p>

    <span class="image main"><img src="/assets/images/tutorials/robot/remote-connect-vsc.png" alt=""
        style="max-width:800px;" /></span>

    <h2 id="conn_video"> Video Tutorial</h2>

    <p>This video tutorial goes through the process outlined above.</p>

    <div style="display: flex; justify-content: center; align-items: center;">
      <iframe style="display:block" width="560" height="315" src="https://www.youtube.com/embed/65J26m_rSxE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
  </div>
</section>

<!-- WEB APP TUTORIAL -->
<section id="localization">
  <header class="major">
    <h2><a href="#localization">SLAM Web App Tutorial</a></h2>
  </header>
  <div class="content">
    <p>This tutorial will go over how to build a map of your current environment using SLAM.</p>

    <h3>Prerequisites</h3>

    <p>This tutorial assumes that you have followed the tutorial "Connecting to your Robot" above, and that you have your robot's IP address.</p>

    <h3>1. Access the Web App</h3>

    <p>
      First, we want to open the MBot Web App. Type your robot's IP address into your browser. This should open the web app, shown below:
    </p>

    <span class="image main"><img src="/assets/images/tutorials/robot/mapp_starting.png" alt=""
        style="max-width:800px;" /></span>

    <p>If the robot is connected and working properly, you should be able to see the green "Connected" sign.</p>

    <h3>2. Turn on mapping mode</h3>

    <p>
      Toggle <strong>Localization Mode</strong> to on. You should see the map currently saved on the robot on the right. If you have never made a map before, it might be blank. If you don't see this, or if localization mode toggles off again, make sure your LiDAR is spinning, and try restarting your robot. If these fixes don't work, come to an instructor.
    </p>

    <p>
      When localization is enabled, you should see the <strong>Mapping Mode</strong> switch. Place your robot in your physical environment, and when you are ready to start mapping, toggle <strong>Mapping Mode</strong> to on. This will give you a popup stating "This will overwrite the current map. Are you sure?". Press <strong>OK</strong>.
    </p>

    <span class="image main"><img src="/assets/images/tutorials/robot/mapping_mode.png" alt=""
      style="max-width:800px;" /></span>

    <h3>3. Build a map</h3>

    <p>
      Now you should be ready to build your map. The idea is to drive around the physical space until you have an accurate reading of the physical environment with no missing borders. To drive around, toggle the <strong>Drive Mode</strong> switch.
    </p>

    <ul class="hint">
      <li class="icon solid fa-cogs"><strong>Driving Tips:</strong> Make sure you drive slowly and give the robot some time to build its current environment before you drive again. Try to limit jerky movements and excessive turning. Forward and backwards movement works best. DO NOT bump into any of the obstacles. If you do, reset your map and try again. Another source of error could be that your wheels are not tight, but if that doesn't fix the problem when following the aforementioned tips, come to an instructor. </li>
    </ul>

    <p>
      The image below shows a good mapping of the environment, where the map is consistent to the physical space. There are also no incomplete edges or shifts.
    </p>

    <span class="image main"><img src="/assets/images/tutorials/robot/good_map.png" alt=""
      style="max-width:800px;" /></span>

    <p>
      The image below shows a bad mapping of the same environment above, where the map is inconsistent, and the edges are not clear. If your map looks like this, you might want to reset it using the &quot;Reset Map&quot; button.
    </p>

    <span class="image main"><img src="/assets/images/tutorials/robot/bad_map.png" alt=""
      style="max-width:800px;" /></span>

    <h3>4. Switch to localization mode</h3>

    <p>
      Once you have a good map of the environment, turn off mapping mode. The map will be automatically saved on the robot in file <code>~/current.map</code>.
    </p>

    <p>You can reuse this map to localize in the same environment if you restart the robot or toggle localization on and off again. You should make sure the robot is correctly localized in the map when localization is turned back on.</p>

    <p>If you want to download your map for testing off the robot, click on the <strong>Download Map</strong> button to save it. </p>

    <!-- <h2 id="loc_video"> Video Tutorial</h2> -->

    <!-- <p>This video tutorial goes through the process outlined above.</p> -->

    <!-- <div style="display: flex; justify-content: center; align-items: center;"> -->
      <!-- <iframe style="display:block" width="560" height="315" src="https://www.youtube.com/watch?v=LzMrtliWKR8&ab_channel=LaasyaChukka" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> -->
    <!-- </div> -->
  </div>
</section>
